<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BookMood - Challenges</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static', filename='cleaned_styles.css') }}" />
<style>
    /* Navigation Bar */
    .navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: rgba(15, 15, 35, 0.9);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding: 1rem 0;
        z-index: 1000;
    }

    .nav-container {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 2rem;
    }

    .nav-logo {
        font-size: 1.5rem;
        font-weight: 800;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-decoration: none;
    }

    .nav-links {
        display: flex;
        gap: 2rem;
        align-items: center;
    }

    .nav-links a {
        color: var(--text-secondary);
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s ease;
        position: relative;
    }

    .nav-links a:hover,
    .nav-links a.active {
        color: var(--text-primary);
    }

    .nav-links a::after {
        content: '';
        position: absolute;
        bottom: -5px;
        left: 0;
        width: 0;
        height: 2px;
        background: var(--primary-gradient);
        transition: width 0.3s ease;
    }

    .nav-links a:hover::after,
    .nav-links a.active::after {
        width: 100%;
    }

    /* Main content adjustment for fixed navbar */
    body {
        padding-top: 80px;
    }

    /* Hamburger Menu Styles */
    .hamburger-container {
        position: fixed;
        top: 10px;
        right: 10px;
        z-index: 1100;
    }
    .hamburger-btn {
        font-size: 24px;
        background: rgba(0, 0, 0, 0.7);
        border: 2px solid #fff;
        border-radius: 8px;
        padding: 8px 12px;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
        color: white;
        transition: background-color 0.3s ease;
    }
    .hamburger-btn:hover {
        background: rgba(255, 255, 255, 0.2);
    }
    .hamburger-menu {
        display: none;
        position: absolute;
        top: 40px;
        right: 0;
        background: rgba(15, 15, 35, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.4);
        padding: 10px;
        min-width: 180px;
    }
    .hamburger-menu a {
        display: block;
        padding: 8px;
        color: white;
        text-decoration: none;
        border-radius: 6px;
    }
    .hamburger-menu a:hover {
        background: rgba(255, 255, 255, 0.1);
    }
    .menu-header {
        padding: 10px;
        font-weight: bold;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        margin-bottom: 8px;
        color: white;
    }

    /* Challenge-specific styles */
    .challenge-section {
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 24px;
        padding: 3rem;
        text-align: center;
        margin: 2rem auto;
        max-width: 600px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    .streak-display {
        background: var(--primary-gradient);
        color: white;
        padding: 1rem 2rem;
        border-radius: 50px;
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 2rem;
        display: inline-block;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .challenge-title {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 1rem;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .challenge-text {
        font-size: 1.3rem;
        color: var(--text-secondary);
        margin-bottom: 2rem;
        font-weight: 500;
    }

    .complete-btn {
        background: var(--primary-gradient);
        border: none;
        color: white;
        padding: 1rem 3rem;
        border-radius: 50px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .complete-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
    }

    .complete-btn:active {
        transform: translateY(0);
    }

    @media (max-width: 768px) {
        .nav-container {
            flex-direction: column;
            gap: 1rem;
        }

        .nav-links {
            gap: 1rem;
        }

        body {
            padding-top: 120px;
        }

        .challenge-section {
            padding: 2rem;
            margin: 1rem;
        }

        .challenge-title {
            font-size: 1.5rem;
        }

        .challenge-text {
            font-size: 1.1rem;
        }
    }
</style>
</head>
<body>
    <!-- Background Animation -->
    <div class="bg-animation">
        <div class="bg-shape"></div>
        <div class="bg-shape"></div>
        <div class="bg-shape"></div>
    </div>

    <!-- Hamburger Menu -->
    <div class="hamburger-container">
        <button class="hamburger-btn" onclick="toggleMenu()">â˜°</button>
        <div id="hamburgerMenu" class="hamburger-menu" aria-label="Navigation menu">
            <div class="menu-header">
                ðŸ‘¤ {{ username }}
            </div>
            <a href="/">Home</a>
            <a href="/shelves">Shelves</a>
            <a href="/challenges">Challenges</a>
            <a href="/badges">Badges</a>
            <a href="/about">About</a>
            <hr style="border-color: rgba(255,255,255,0.2);" />
            <a href="/logout" class="logout-btn" style="color:#ff6b6b;">ðŸšª Logout</a>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="/" class="nav-logo">ðŸ“š BookMood</a>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="/shelves">My Shelves</a>
                <a href="/challenges" class="active">Challenges</a>
                <a href="/badges">Badges</a>
                <a href="/about">About</a>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ðŸŽ¯ Daily Reading Challenge</h1>
            <p>Complete daily challenges to build your reading streak and earn badges!</p>
        </div>

        <!-- Challenge Content -->
        <div class="content">
            <div class="challenge-section">
                <div class="streak-display" id="streak">
                    ðŸ”¥ Streak: 0 days
                </div>
                <h2 class="challenge-title">Today's Challenge</h2>
                <p class="challenge-text" id="challengeText">Loading challenge...</p>
                <button class="complete-btn" onclick="markDone()">
                    âœ¨ Mark as Complete
                </button>
            </div>
        </div>
    </div>

    <script>
        function toggleMenu() {
            const menu = document.getElementById("hamburgerMenu");
            menu.style.display = (menu.style.display === "block") ? "none" : "block";
        }

        // Close menu if clicked outside
        document.addEventListener("click", function (event) {
            const menu = document.getElementById("hamburgerMenu");
            const btn = document.querySelector(".hamburger-btn");
            if (!menu.contains(event.target) && !btn.contains(event.target)) {
                menu.style.display = "none";
            }
        });

        // Challenges by day
        const challenges = {
            "Monday": "ðŸ“– Read 10 pages",
            "Tuesday": "ðŸ“š Read a short story",
            "Wednesday": "ðŸŒŸ Try a new genre",
            "Thursday": "ðŸŒ™ Read before bed",
            "Friday": "ðŸ“Š Read 20 pages",
            "Saturday": "â­ Review a book",
            "Sunday": "ðŸ† Finish a book"
        };

        // LocalStorage
        let streakData = JSON.parse(localStorage.getItem("streakData") || '{"streak":0,"lastDate":""}');
        let userBadges = JSON.parse(localStorage.getItem("userBadges") || '[]');

        function getToday() {
            return new Date().toLocaleDateString('en-US', { weekday: 'long' });
        }

        function initializeChallenge() {
            const today = getToday();
            document.getElementById("challengeText").innerText = challenges[today] || challenges["Monday"];
            document.getElementById("streak").innerHTML = `ðŸ”¥ Streak: ${streakData.streak} days`;
        }

        function markDone() {
            const today = getToday();
            const button = document.querySelector(".complete-btn");
            
            // Visual feedback
            button.disabled = true;
            button.textContent = "âœ… Completed!";
            
            // Check streak
            const now = new Date().toLocaleDateString();
            if (streakData.lastDate !== now) {
                streakData.streak += 1;
                streakData.lastDate = now;
                localStorage.setItem("streakData", JSON.stringify(streakData));
            }

            // Update badge: keep only last earned for this type
            let badgeIndex = userBadges.findIndex(b => b.name === challenges[today]);
            let count = 1;
            if (badgeIndex >= 0) {
                count = userBadges[badgeIndex].count + 1;
                // Upgrade rank
                if (count >= 18) { count = 1; userBadges[badgeIndex].rank = "platinum"; }
                else if (count >= 13) userBadges[badgeIndex].rank = "diamond";
                else if (count >= 8) userBadges[badgeIndex].rank = "gold";
                else if (count >= 3) userBadges[badgeIndex].rank = "silver";
                else userBadges[badgeIndex].rank = "bronze";
                userBadges[badgeIndex].count = count;
                userBadges[badgeIndex].lastEarned = new Date().toLocaleDateString();
            } else {
                userBadges.push({ 
                    name: challenges[today], 
                    rank: "bronze", 
                    count: 1, 
                    lastEarned: new Date().toLocaleDateString() 
                });
            }

            localStorage.setItem("userBadges", JSON.stringify(userBadges));
            initializeChallenge();
            
            // Show success message
            setTimeout(() => {
                alert("ðŸŽ‰ Challenge Completed! Badge updated. Check your badges page!");
                button.disabled = false;
                button.textContent = "âœ¨ Mark as Complete";
            }, 1000);
        }

        window.addEventListener('load', initializeChallenge);
    </script>
</body>
</html>